- Redis 和 Memcached 有什么区别？Redis 的线程模型是什么？为什么单线程的 Redis 比多线程的 Memcached 效率要高得多？

  Memcached的value只能是String；

- Redis 的过期策略都有哪些？手写一下 LRU 代码实现？

- 如何保证 Redis 高并发、高可用？Redis 的主从复制原理能介绍一下么？Redis 的哨兵原理能介绍一下么？

- Redis 的持久化有哪几种方式？不同的持久化机制都有什么优缺点？持久化机制具体底层是如何实现的？

- Redis 集群模式的工作原理能说一下么？在集群模式下，Redis 的 key 是如何寻址的？分布式寻址都有哪些算法？了解一致性 hash 算法吗？如何动态增加和删除一个节点？

- 了解什么是 redis 的雪崩、穿透和击穿？Redis 崩溃之后会怎么样？系统该如何应对这种情况？如何处理 Redis 的穿透？

- 如何保证缓存与数据库的双写一致性？

- Redis 的并发竞争问题是什么？如何解决这个问题？了解 Redis 事务的 CAS 方案吗？

- 生产环境中的 Redis 是怎么部署的？



- 



## 数据类型

**Redis 都有哪些数据类型？分别在哪些场景下使用比较合适？**



## 线程模型

**Redis 真的只有单线程吗？**

不是，Redis 单线程是指它对网络 IO 和数据读写的操作采用了一个线程；但 Redis 的其他功能，比如持久化、异步删除、集群数据同步等，其实是由额外的线程执行的。



**基于多路复用的Redis高性能IO模型**

![](./pic/高性能IO模型.jpg)



**为什么单线程的 Redis 能那么快？**

1. 读写操作都在内存中
2. 高性能网络I/O模型
3. 避免了多线程并发控制带来的开销

## 持久化

AOF(Append only file) 和 RDB(Redis database)

**AOF写回策略**

- **Always**，同步写回：每个写命令执行完，立马同步地将日志写回磁盘；
- **Everysec**，每秒写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，每隔一秒把缓冲区中的内容写入磁盘；
- **No**，操作系统控制的写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘。



**AOF 重写机制**

目的为了减小AOF日志的大小；重写过程是由后台子进程 bgrewriteaof 来完成的；

AOF 重写机制就是在重写时，Redis 根据数据库的现状创建一个新的 AOF 文件，也就是说，读取数据库中的所有键值对，然后对每一个键值对用一条命令记录它的写入。

每次 AOF 重写时，Redis 会先执行一个内存拷贝，用于重写；然后，使用两个日志保证在重写过程中，新写入的数据不会丢失。最后，等到拷贝数据的所有操作记录重写完成后，重写日志记录的这些最新操作也会写入新的 AOF 文件，以保证数据库最新状态的记录。



**AOF可能阻塞点**

- AOF重写时，父进程会调用fork，会阻塞，实例越大，阻塞越久。
- Copyonwrite机制在write时也会阻塞进行内存复制，如果开启了内存大页机制，阻塞时间将会更久。



**RDB给哪些数据做快照**

全量数据



**生成 RDB 文件两个命令**

- save: 在主线程中执行，会导致阻塞；

- bgsave: 创建一个子进程，专门用于写入 RDB 文件，避免了主线程的阻塞，这也是 Redis RDB 文件生成的默认配置。

  

**混合使用 AOF 日志和内存快照**

内存快照以一定的频率执行，在两次快照之间，使用 AOF 日志记录这期间的所有命令操作。



## 主从同步

**主从同步三种模式**

1. **全量复制**：主库生成RDB文件并发送给从库。从库接收之后，清空当前数据库，加载RDB文件。最后将replication buffer中记录的新命令发送给从库。

2. **基于长连接的命令传播**：主从之间一直维护一个网络连接，主库会通过这个连接将后续陆续收到的命令操作再同步给从库。

3. **增量复制**：当主从库断连后，主库会把断连期间收到的写操作命令，写入 repl_backlog_buffer 这个缓冲区。repl_backlog_buffer 是一个环形缓冲区，主库会记录自己写到的位置，从库则会记录自己已经读到的位置。

   调整 repl_backlog_size 这个参数来控制repl_backlog_buffer的大小。通过调大这个参数，可以减少从库在网络断连时全量复制的风险。



**主从复制为什么不用AOF日志？**

RDB文件更小因此传输效率更高；同时，数据恢复速度更快。