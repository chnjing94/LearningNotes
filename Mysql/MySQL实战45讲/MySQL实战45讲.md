# 2. 日志系统

##一条SQL更新语句是如何执行的？

```sql
mysql> create table T(ID int primary key, c int);
mysql> update T set c=c+1 where ID=2;
```

![](./pic/2-update执行过程.png)

## 两阶段提交

更新完内存中的数据之后，写入redo log，并处于prepare阶段，但并事务没有提交，即使此时

刷盘，之后被读出来依然是未提交数据。等到binlog写入完成，将事务正式提交，处于commit状态。

两阶段提交的目的是为了保证数据库的状态和用它的日志恢复出来的库的状态一致，如果没有两阶段提交，无论先写binlog还是先写redo log，在系统崩溃的情况下，都会出错。

# 3. 事务隔离

## 视图

读已提交和可重复读的实现方式是创建视图，然后通过MVCC控制事务能够访问的数据。在“可重复读”的隔离模式下，视图是在事务启动的时候创建的，整个事务存在期间都用这个视图。

在“读已提交”的隔离模式下，视图是在每个SQL语句开始执行的时候创建的。

![](./pic/3-MVCC.png)

